<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        
        .main-header {
            background-color: #f5f5f5;
            padding: 10px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .main-title {
            font-size: 24px;
            margin: 0;
        }
        
        .update-btn {
            background-color: #5cb85c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .box {
            background-color: #fff;
            border-radius: 0;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .left-sidebar {
            width: 280px;
        }
        
        .main-content {
            flex: 1;
            min-width: 300px;
        }
        
        .section-title {
            font-size: 18px;
            margin-top: 0;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .calendar-nav {
            cursor: pointer;
            background: none;
            border: none;
            font-size: 16px;
        }
        
        .calendar-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .calendar-table th, .calendar-table td {
            text-align: center;
            padding: 8px;
            font-size: 14px;
        }
        
        .calendar-table th {
            font-weight: normal;
        }
        
        .calendar-table .current-day {
            background-color: #4285f4;
            color: white;
            border-radius: 0;
        }
        
        .calendar-table .selected-day {
            background-color: #5cb85c;
            color: white;
            border-radius: 0;
        }
        
        .calendar-day {
            cursor: pointer;
        }
        
        .calendar-day:hover {
            background-color: #eef;
        }
        
        .stats-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .stats-header {
            font-weight: bold;
        }
        
        .stats-col-stage {
            flex: 1;
        }
        
        .stats-col-count, .stats-col-sum {
            width: 120px;
            text-align: center;
        }
        
        .webhook-types-container {
            margin-top: 30px;
        }
        
        .webhook-types {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .webhook-type {
            padding: 15px;
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .webhook-type:hover {
            background-color: #f0f0f0;
        }
        
        .webhook-type-title {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .webhook-count {
            display: block;
        }
        
        .date-info {
            font-size: 14px;
            color: #666;
            margin-top: 15px;
            line-height: 1.6;
        }
        
        .webhook-list {
            margin-top: 30px;
        }
        
        .webhook-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .webhook-table th, .webhook-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .webhook-table th {
            background-color: #f2f2f2;
            font-weight: normal;
        }
        
        .grayed-text {
            color: #888;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #ddd;
            width: 80%;
            max-width: 1000px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .modal-close:hover {
            color: #555;
        }
        
        .filtered-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .filtered-table th, .filtered-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .filtered-table th {
            background-color: #f2f2f2;
        }
        
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Filter controls */
        .filter-controls {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .filter-tag {
            background-color: #e0e7ff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            display: flex;
            align-items: center;
        }
        
        .filter-tag .remove {
            margin-left: 6px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* KPI Cards */
        .kpi-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .kpi-card {
            background-color: #fff;
            border-radius: 0;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            flex: 1;
            min-width: 180px;
        }
        
        .kpi-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
        }
        
        .kpi-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .kpi-formula {
            font-size: 11px;
            color: #888;
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π */
        .kpi-card.website-confirmations {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .kpi-card.website-confirmations .kpi-title {
            color: #e8f0ff;
        }
        
        .kpi-card.website-confirmations .kpi-formula {
            color: #d0deff;
        }
        
        .kpi-card.whatsapp-night {
            background: linear-gradient(135deg, #434343 0%, #000000 100%);
            color: white;
        }
        
        .kpi-card.whatsapp-night .kpi-title {
            color: #e8e8e8;
        }
        
        .kpi-card.whatsapp-night .kpi-formula {
            color: #cccccc;
        }
        
        .kpi-card.whatsapp-work {
            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
            color: white;
        }
        
        .kpi-card.whatsapp-work .kpi-title {
            color: #e8f5e8;
        }
        
        .kpi-card.whatsapp-work .kpi-formula {
            color: #d0f0d0;
        }
        
        .period-info {
            text-align: right;
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        .moscow-time {
            display: inline-block;
            color: #666;
            font-size: 14px;
            padding-left: 5px;
        }
        
        .time-display {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 10px;
            color: #666;
        }
        
        .current-time {
            font-weight: bold;
            margin-left: 5px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞ */
        .time-filter-container {
            margin-top: 20px;
        }
        
        .time-filter-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        
        .filter-option {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .time-input {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .time-range-inputs {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 5px;
        }
        
        .current-filter-info {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ */
        .time-filter-active {
            background-color: #e8f5e9;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            border-left: 4px solid #5cb85c;
        }

        /* –°–µ–∫—Ü–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö –≤–µ–±—Ö—É–∫–æ–≤ */
        .website-webhooks-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #667eea;
        }
        
        .whatsapp-webhooks-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #25d366;
        }
        
        .whatsapp-night-section {
            margin-bottom: 30px;
        }
        
        .whatsapp-work-section {
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <header class="main-header">
        <h1 class="main-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤</h1>
        <div class="time-display">
            –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è: <span class="current-time" id="moscowTime"></span>
            <button class="update-btn" style="margin-left: 15px;" onclick="location.reload()">–û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
    </header>
    
    <div class="container">
        <div class="box left-sidebar">
            <h2 class="section-title">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</h2>
            <div class="calendar-header">
                <button class="calendar-nav" onclick="prevMonth()">‚Üê</button>
                <span id="currentMonth">–ú–∞—Ä—Ç 2025</span>
                <button class="calendar-nav" onclick="nextMonth()">‚Üí</button>
            </div>
            
            <table class="calendar-table">
                <thead>
                    <tr>
                        <th>–ü–Ω</th>
                        <th>–í—Ç</th>
                        <th>–°—Ä</th>
                        <th>–ß—Ç</th>
                        <th>–ü—Ç</th>
                        <th>–°–±</th>
                        <th>–í—Å</th>
                    </tr>
                </thead>
                <tbody id="calendarBody">
                    <!-- Calendar will be generated here by JavaScript -->
                </tbody>
            </table>
            
            <div class="date-info">
                –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞: <span id="currentDate">{{ current_date }}</span><br>
                –†–∞—Å—á–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥: –¥–æ 21:00 (–ú–°–ö)<br><br>
                <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –¥–ª—è:</strong><br>
                <span id="processingDate">{{ processing_date }}</span>
            </div>

            <!-- –í—Ä–µ–º–µ–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä -->
            <div class="time-filter-container">
                <h2 class="section-title">–í—Ä–µ–º–µ–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä</h2>
                <div class="time-filter-controls">
                    <div class="filter-option">
                        <input type="radio" id="fullDay" name="timeFilterType" value="fullDay" checked>
                        <label for="fullDay">–ü–æ–ª–Ω—ã–π –¥–µ–Ω—å</label>
                    </div>
                    <div class="filter-option">
                        <input type="radio" id="specificTime" name="timeFilterType" value="specificTime">
                        <label for="specificTime">–ù–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è</label>
                        <input type="time" id="specificTimeValue" class="time-input" disabled>
                    </div>
                    <div class="filter-option">
                        <input type="radio" id="timeRange" name="timeFilterType" value="timeRange">
                        <label for="timeRange">–í—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω</label>
                        <div class="time-range-inputs">
                            <input type="time" id="timeFrom" class="time-input" disabled>
                            <span>–¥–æ</span>
                            <input type="time" id="timeTo" class="time-input" disabled>
                        </div>
                    </div>
                    <button id="applyTimeFilter" class="update-btn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                </div>
                
                <!-- –¢–µ–∫—É—â–∏–π —Ñ–∏–ª—å—Ç—Ä -->
                {% if time_point or (time_from and time_to) %}
                <div class="time-filter-active">
                    {% if time_point %}
                        <strong>–ê–∫—Ç–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä:</strong> –î–∞–Ω–Ω—ã–µ –Ω–∞ {{ time_point }}
                    {% elif time_from and time_to %}
                        <strong>–ê–∫—Ç–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä:</strong> –î–∞–Ω–Ω—ã–µ —Å {{ time_from }} –¥–æ {{ time_to }}
                    {% endif %}
                </div>
                {% else %}
                <div class="current-filter-info">
                    <span id="currentTimeFilter">–ü–æ–∫–∞–∑–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –∑–∞ –≤–µ—Å—å –¥–µ–Ω—å</span>
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="box main-content">
            <div class="period-info">—Ä–∞—Å—á–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –¥–Ω—è —Å 21:01 –¥–æ 21:00 (–ú–°–ö)</div>
            
            <!-- KPI Cards Section -->
            <div class="kpi-container">
                <div class="kpi-card">
                    <div class="kpi-title">% –æ—Ç–º–µ–Ω</div>
                    <div class="kpi-value" id="cancellationRate">
                        {{ kpis.cancellation_rate }}%
                    </div>
                    <div class="kpi-formula">=(–ø.14+–ø.19+–ø.23)/–ø.7*100%</div>
                </div>
                
                <div class="kpi-card">
                    <div class="kpi-title">% –Ω–µ–¥–æ–∑–≤–æ–Ω–æ–≤</div>
                    <div class="kpi-value" id="missedCallsRate">
                        {{ kpis.missed_calls_rate }}%
                    </div>
                    <div class="kpi-formula">=(–ø.15+–ø.20+–ø.24)/–ø.7*100%</div>
                </div>
                
                <div class="kpi-card">
                    <div class="kpi-title">–°—É–º–º–∞ –ø–æ–¥—Ç–≤. –∑–∞–∫–∞–∑–æ–≤</div>
                    <div class="kpi-value" id="confirmedOrdersSum">
                        {{ kpis.confirmed_orders_sum }},00 ‚ÇΩ
                    </div>
                    <div class="kpi-formula">=–ø.13+–ø.18+–ø.22</div>
                </div>
                
                <div class="kpi-card website-confirmations">
                    <div class="kpi-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ —Å–∞–π—Ç–µ</div>
                    <div class="kpi-value" id="websiteConfirmationsSum">
                        {{ kpis.website_confirmations_sum }},00 ‚ÇΩ
                    </div>
                    <div class="kpi-formula">=–ø.31+–ø.32+–ø.33+–ø.34</div>
                </div>
                
                <div class="kpi-card whatsapp-night">
                    <div class="kpi-title">üåô WhatsApp –Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è</div>
                    <div class="kpi-value" id="whatsappNightSum">
                        {{ kpis.whatsapp_night_sum }},00 ‚ÇΩ
                    </div>
                    <div class="kpi-formula">=–ø.35+–ø.36+–ø.37+–ø.38+–ø.39</div>
                </div>
                
                <div class="kpi-card whatsapp-work">
                    <div class="kpi-title">‚òÄÔ∏è WhatsApp —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è</div>
                    <div class="kpi-value" id="whatsappWorkSum">
                        {{ kpis.whatsapp_work_sum }},00 ‚ÇΩ
                    </div>
                    <div class="kpi-formula">=–ø.40+–ø.41+–ø.42+–ø.43+–ø.44</div>
                </div>
                
                <div class="kpi-card">
                    <div class="kpi-title">–ö–æ–ª-–≤–æ –æ—Ç–º–µ–Ω</div>
                    <div class="kpi-value" id="cancellationCount">
                        {{ kpis.cancellation_count }}
                    </div>
                    <div class="kpi-formula">=–ø.14+–ø.19+–ø.23</div>
                </div>
                
                <div class="kpi-card">
                    <div class="kpi-title">–ö–æ–ª-–≤–æ –Ω–µ–¥–æ–∑–≤–æ–Ω–æ–≤</div>
                    <div class="kpi-value" id="missedCallsCount">
                        {{ kpis.missed_calls_count }}
                    </div>
                    <div class="kpi-formula">=–ø.15+–ø.20+–ø.24</div>
                </div>
            </div>
            <h2 class="section-title">–°—É–º–º–∞ –∏—Ç–æ–≥: {{ stats.total_sum if stats.total_sum else 0 }}</h2>
            <h3 class="section-title" style="margin-top: 10px;">–í–µ–±—Ö—É–∫–æ–≤ –∏—Ç–æ–≥: {{ stats.total_count }}</h3>
            
            <div class="stats-container">
                <div class="stats-row stats-header">
                    <div class="stats-col-stage">–°—Ç–∞–¥–∏—è</div>
                    <div class="stats-col-count">–ü—Ä–∏—à–ª–æ –≤–µ–±—Ö—É–∫–æ–≤</div>
                    <div class="stats-col-sum">–°—É–º–º–∞</div>
                </div>
                
                {% for i in range(1, 47) %}
                <div class="stats-row">
                    <div class="stats-col-stage">–°—Ç–∞–¥–∏—è {{ i }}</div>
                    <div class="stats-col-count">{{ stats['hook' ~ i ~ '_count'] or 0 }}</div>
                    <div class="stats-col-sum">{{ stats['hook' ~ i ~ '_sum'] or 0 }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <div class="container webhook-types-container">
        <div class="box" style="width: 100%;">
            <h2 class="section-title">–¢–∏–ø—ã –≤–µ–±—Ö—É–∫–æ–≤</h2>
            <div class="webhook-types">
                {% set webhook_types = {
                    1: "–í—Å–µ —Å–¥–µ–ª–∫–∏",
                    2: "–ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞",
                    3: "–±–µ–∑ –¥–∞—Ç—ã",
                    4: "–±–µ–∑ —Ä–µ–≥–∏–æ–Ω–∞",
                    5: "–±–µ–∑ —Å—É–º–º—ã",
                    6: "–±–µ–∑ –∞–¥—Ä–µ—Å–∞",
                    7: "–≤—Å–µ –≥–æ—Ç–æ–≤–æ",
                    8: "–º—Å–∫",
                    9: "–°–ø–±",
                    10: "–†–µ–≥–∏–æ–Ω",
                    11: "–ó–í–æ–Ω–∏–º –±–µ–∑ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã",
                    12: "–ó–≤–æ–Ω–∏–º –±–µ–∑ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤",
                    13: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –∑–∞–∫–∞–∑ –±–µ–∑ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã",
                    14: "–û—Ç–º–µ–Ω–∏–ª –∑–∞–∫–∞–∑ –±–µ–∑ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã",
                    15: "–ù–µ –≤–∑—è–ª —Ç—Ä—É–±–∫—É –±–µ–∑ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã",
                    16: "–ó–í–æ–Ω–∏–º —Å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–æ–π",
                    17: "–ó–≤–æ–Ω–∏–º —Å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–æ–π –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤",
                    18: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –∑–∞–∫–∞–∑ —Å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–æ–π",
                    19: "–û—Ç–º–µ–Ω–∏–ª –∑–∞–∫–∞–∑ —Å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–æ–π",
                    20: "–ù–µ –≤–∑—è–ª —Ç—Ä—É–±–∫—É —Å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–æ–π",
                    21: "–ó–í–æ–Ω–∏–º —Ä–µ–≥–∏–æ–Ω",
                    22: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –∑–∞–∫–∞–∑ —Ä–µ–≥–∏–æ–Ω",
                    23: "–û—Ç–º–µ–Ω–∏–ª –∑–∞–∫–∞–∑ —Ä–µ–≥–∏–æ–Ω",
                    24: "–ù–µ –≤–∑—è–ª —Ç—Ä—É–±–∫—É —Ä–µ–≥–∏–æ–Ω",
                    25: "–Ω–µ–æ–ø–æ–Ω—è—Ç–Ω–æ",
                    26: "–∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—á–∏–∫",
                    27: "–†–µ–∑–µ—Ä–≤",
                    28: "–†–µ–∑–µ—Ä–≤",
                    29: "–†–µ–∑–µ—Ä–≤",
                    30: "–†–µ–∑–µ—Ä–≤"
                } %}
                
                {% for i in range(1, 31) %}
                <div class="webhook-type" data-hook-id="{{ i }}" onclick="showWebhookDetails({{ i }}, '{{ webhook_types[i] }}')">
                    <div class="webhook-type-title">{{ i }}. {{ webhook_types[i] }}</div>
                    <div>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: <span class="webhook-count">{{ stats['hook' ~ i ~ '_count'] or 0 }}</span></div>
                </div>
                {% endfor %}
            </div>
            
            <!-- –û—Ç–¥–µ–ª—å–Ω–∞—è —Å–µ–∫—Ü–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö –≤–µ–±—Ö—É–∫–æ–≤ —Å–∞–π—Ç–∞ -->
            <div class="website-webhooks-section">
                <h3 class="section-title" style="color: #667eea;">üåê –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ —Å–∞–π—Ç–µ</h3>
                <div class="webhook-types">
                    {% set website_types = {
                        31: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –Ω–∞ —Å–∞–π—Ç–µ —Å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–æ–π",
                        32: "–ù–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –Ω–∞ —Å–∞–π—Ç–µ —Å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–æ–π",
                        33: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –Ω–∞ —Å–∞–π—Ç–µ –±–µ–∑ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã",
                        34: "–ù–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –Ω–∞ —Å–∞–π—Ç–µ –±–µ–∑ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã"
                    } %}
                    
                    {% for i in range(31, 35) %}
                    <div class="webhook-type" data-hook-id="{{ i }}" onclick="showWebhookDetails({{ i }}, '{{ website_types[i] }}')">
                        <div class="webhook-type-title">{{ i }}. {{ website_types[i] }}</div>
                        <div>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: <span class="webhook-count">{{ stats['hook' ~ i ~ '_count'] or 0 }}</span></div>
                        <div style="color: #667eea; font-weight: bold;">–°—É–º–º–∞: {{ stats['hook' ~ i ~ '_sum'] or 0 }} ‚ÇΩ</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- –û—Ç–¥–µ–ª—å–Ω–∞—è —Å–µ–∫—Ü–∏—è –¥–ª—è WhatsApp –≤–µ–±—Ö—É–∫–æ–≤ -->
            <div class="whatsapp-webhooks-section">
                <h3 class="section-title" style="color: #25d366;">üí¨ WhatsApp —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                
                <!-- –ù–æ—á–Ω–æ–µ –≤—Ä–µ–º—è -->
                <div class="whatsapp-night-section">
                    <h4 style="color: #434343; margin-bottom: 15px;">üåô –ù–æ—á–Ω–æ–µ –≤—Ä–µ–º—è</h4>
                    <div class="webhook-types">
                        {% set whatsapp_night_types = {
                            35: "–í–∞—Ç—Å–∞–ø –Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –ø–∏—à–µ–º",
                            36: "–í–∞—Ç—Å–∞–ø –Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª",
                            37: "–í–∞—Ç—Å–∞–ø –Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–º–µ–Ω–∏–ª",
                            38: "–í–∞—Ç—Å–∞–ø –Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –∏–∑–º–µ–Ω–∏—Ç—å",
                            39: "–í–∞—Ç—Å–∞–ø –Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª"
                        } %}
                        
                        {% for i in range(35, 40) %}
                        <div class="webhook-type" data-hook-id="{{ i }}" onclick="showWebhookDetails({{ i }}, '{{ whatsapp_night_types[i] }}')">
                            <div class="webhook-type-title">{{ i }}. {{ whatsapp_night_types[i] }}</div>
                            <div>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: <span class="webhook-count">{{ stats['hook' ~ i ~ '_count'] or 0 }}</span></div>
                            <div style="color: #434343; font-weight: bold;">–°—É–º–º–∞: {{ stats['hook' ~ i ~ '_sum'] or 0 }} ‚ÇΩ</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- –†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è -->
                <div class="whatsapp-work-section">
                    <h4 style="color: #25d366; margin-bottom: 15px;">‚òÄÔ∏è –†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è</h4>
                    <div class="webhook-types">
                        {% set whatsapp_work_types = {
                            40: "–í–∞—Ç—Å–∞–ø —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è –ø–∏—à–µ–º",
                            41: "–í–∞—Ç—Å–∞–ø —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª",
                            42: "–í–∞—Ç—Å–∞–ø —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è –æ—Ç–º–µ–Ω–∏–ª",
                            43: "–í–∞—Ç—Å–∞–ø —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è –∏–∑–º–µ–Ω–∏—Ç—å",
                            44: "–í–∞—Ç—Å–∞–ø —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª"
                        } %}
                        
                        {% for i in range(40, 45) %}
                        <div class="webhook-type" data-hook-id="{{ i }}" onclick="showWebhookDetails({{ i }}, '{{ whatsapp_work_types[i] }}')">
                            <div class="webhook-type-title">{{ i }}. {{ whatsapp_work_types[i] }}</div>
                            <div>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: <span class="webhook-count">{{ stats['hook' ~ i ~ '_count'] or 0 }}</span></div>
                            <div style="color: #25d366; font-weight: bold;">–°—É–º–º–∞: {{ stats['hook' ~ i ~ '_sum'] or 0 }} ‚ÇΩ</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- –ò—Ç–æ–≥–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ -->
                <div style="margin-top: 20px;">
                    <h4 style="color: #25d366; margin-bottom: 15px;">üìä –†–µ–∑–µ—Ä–≤ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h4>
                    <div class="webhook-types">
                        {% set whatsapp_summary_types = {
                            45: "–ò—Ç–æ–≥ –Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è",
                            46: "–ò—Ç–æ–≥ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è"
                        } %}
                        
                        {% for i in range(45, 47) %}
                        <div class="webhook-type" data-hook-id="{{ i }}" onclick="showWebhookDetails({{ i }}, '{{ whatsapp_summary_types[i] }}')">
                            <div class="webhook-type-title">{{ i }}. {{ whatsapp_summary_types[i] }}</div>
                            <div>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: <span class="webhook-count">{{ stats['hook' ~ i ~ '_count'] or 0 }}</span></div>
                            <div style="color: #25d366; font-weight: bold;">–°—É–º–º–∞: {{ stats['hook' ~ i ~ '_sum'] or 0 }} ‚ÇΩ</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container webhook-list">
        <div class="box" style="width: 100%;">
            <h2 class="section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –≤–µ–±—Ö—É–∫–∏</h2>
            <table class="webhook-table">
                <thead>
                    <tr>
                        <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–í—Ä–µ–º—è (–ú–°–ö)</th>
                        <th>–°—É–º–º–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for webhook in recent_webhooks %}
                    <tr>
                        <td>{{ webhook[1] }}</td>
                        <td>{{ webhook[2] or '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è' }}</td>
                        <td>{{ webhook[3] }}</td>
                        <td>{{ webhook[4] or 0 }}</td>
                    </tr>
                    {% endfor %}
                    
                    {% if recent_webhooks|length == 0 %}
                    <tr>
                        <td colspan="4" class="grayed-text">–ù–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –≤–µ–±—Ö—É–∫–æ–≤</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal for webhook details -->
    <div id="webhookModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">–î–µ—Ç–∞–ª–∏ –≤–µ–±—Ö—É–∫–æ–≤</h2>
            
            <div class="filter-controls">
                <div class="active-filters" id="activeFilters"></div>
            </div>
            
            <div id="modalLoader" class="loader"></div>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // Get the current URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const selectedDateParam = urlParams.get('date');
        const timePoint = urlParams.get('timePoint');
        const timeFrom = urlParams.get('timeFrom');
        const timeTo = urlParams.get('timeTo');
        
        // Moscow Time Clock
        function updateMoscowTime() {
            // Moscow is UTC+3
            const now = new Date();
            const moscowOffset = 3 * 60 * 60 * 1000; // Moscow offset in milliseconds
            const utc = now.getTime() + (now.getTimezoneOffset() * 60 * 1000);
            const moscowTime = new Date(utc + moscowOffset);
            
            const hours = moscowTime.getHours().toString().padStart(2, '0');
            const minutes = moscowTime.getMinutes().toString().padStart(2, '0');
            const seconds = moscowTime.getSeconds().toString().padStart(2, '0');
            
            document.getElementById('moscowTime').textContent = `${hours}:${minutes}:${seconds}`;
        }
        
        // Update Moscow time every second
        updateMoscowTime();
        setInterval(updateMoscowTime, 1000);
        
        // Track the current view date (for filtering)
        let currentViewDate = "{{ processing_date }}";
        let currentHookType = null;
        
        // Parse the date format (dd.mm.yyyy) for comparison
        function parseFormattedDate(dateStr) {
            const parts = dateStr.split('.');
            return new Date(parts[2], parts[1] - 1, parts[0]);
        }
        
        // Generate calendar
        function generateCalendar(year, month) {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            let startingDay = firstDay.getDay() || 7; // Convert Sunday (0) to 7 for easier calculation
            startingDay--; // Adjust to start from Monday (1-7 instead of 0-6)
            
            const totalDays = lastDay.getDate();
            const weeks = Math.ceil((totalDays + startingDay) / 7);
            
            let calendarHTML = '';
            
            // Get previous month's last days
            const prevMonth = new Date(year, month, 0);
            const prevMonthDays = prevMonth.getDate();
            
            let dayCount = 1;
            let nextMonthDay = 1;
            
            for (let i = 0; i < weeks; i++) {
                calendarHTML += '<tr>';
                
                for (let j = 0; j < 7; j++) {
                    if (i === 0 && j < startingDay) {
                        // Previous month days
                        const prevDate = prevMonthDays - startingDay + j + 1;
                        calendarHTML += `<td class="grayed-text">${prevDate}</td>`;
                    } else if (dayCount <= totalDays) {
                        // Current month days
                        const isToday = new Date(year, month, dayCount).getTime() === today.getTime();
                        const formattedDay = dayCount < 10 ? '0' + dayCount : dayCount;
                        const formattedMonth = (month + 1) < 10 ? '0' + (month + 1) : (month + 1);
                        const dateStr = `${formattedDay}.${formattedMonth}.${year}`;
                        
                        // Check if this date is the selected date
                        let isSelected = false;
                        if (selectedDateParam && selectedDateParam === dateStr) {
                            isSelected = true;
                        } else if (!selectedDateParam && dateStr === currentViewDate) {
                            isSelected = true;
                        }
                        
                        const classNames = [];
                        if (isToday) classNames.push('current-day');
                        if (isSelected) classNames.push('selected-day');
                        if (!isToday && !isSelected) classNames.push('calendar-day');
                        
                        calendarHTML += `<td class="${classNames.join(' ')}" 
                                        onclick="selectDate('${dateStr}')">${dayCount}</td>`;
                        dayCount++;
                    } else {
                        // Next month days
                        calendarHTML += `<td class="grayed-text">${nextMonthDay}</td>`;
                        nextMonthDay++;
                    }
                }
                
                calendarHTML += '</tr>';
            }
            
            document.getElementById('calendarBody').innerHTML = calendarHTML;
            
            // Update month name
            const monthNames = [
                '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', 
                '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
            ];
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;
        }
        
        // Initialize calendar - with month detection from URL parameter
        const currentDate = new Date();
        let currentYear = currentDate.getFullYear();
        let currentMonth = currentDate.getMonth();
        
        // If there's a date parameter, set the calendar to that month/year
        if (selectedDateParam) {
            const selectedDate = parseFormattedDate(selectedDateParam);
            currentYear = selectedDate.getFullYear();
            currentMonth = selectedDate.getMonth();
        }
        
        generateCalendar(currentYear, currentMonth);
        
        // Navigation functions
        function prevMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar(currentYear, currentMonth);
        }
        
        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            generateCalendar(currentYear, currentMonth);
        }
        
        // Select date from calendar
        function selectDate(dateStr) {
            // Update current view date
            currentViewDate = dateStr;
            document.getElementById('processingDate').textContent = dateStr;
            
            // Update the UI to show the selected date
            const cells = document.querySelectorAll('.calendar-day, .current-day, .selected-day');
            cells.forEach(cell => {
                if (cell.innerText && cell.onclick) {
                    const cellDate = cell.onclick.toString().match(/'([^']+)'/)[1];
                    if (cellDate === dateStr) {
                        cell.classList.add('selected-day');
                    } else {
                        cell.classList.remove('selected-day');
                    }
                }
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Ä–µ–º–µ–Ω–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            let url = `/?date=${dateStr}`;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Ä–µ–º–µ–Ω–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            if (timePoint) {
                url += `&timePoint=${timePoint}`;
            } else if (timeFrom && timeTo) {
                url += `&timeFrom=${timeFrom}&timeTo=${timeTo}`;
            }
            
            // Refresh page with the new date
            window.location.href = url;
        }
        
        // Open modal with webhook details
        function showWebhookDetails(hookId, hookName) {
            // Set current hook type
            currentHookType = hookId;
            
            // Update modal title
            document.getElementById('modalTitle').textContent = `–î–µ—Ç–∞–ª–∏ –≤–µ–±—Ö—É–∫–æ–≤: ${hookId}. ${hookName}`;
            
            // Show loader
            document.getElementById('modalLoader').style.display = 'block';
            document.getElementById('modalContent').innerHTML = '';
            
            // Clear existing filters
            document.getElementById('activeFilters').innerHTML = '';
            
            // Add date filter
            addFilterTag('date', currentViewDate);
            
            // Add webhook type filter
            addFilterTag('type', hookId);
            
            // Fetch webhook details from API
            let apiUrl = `/api/webhooks?date=${currentViewDate}&hook_type=hook${hookId}_count`;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Ä–µ–º–µ–Ω–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            if (timePoint) {
                apiUrl += `&timePoint=${timePoint}`;
            } else if (timeFrom && timeTo) {
                apiUrl += `&timeFrom=${timeFrom}&timeTo=${timeTo}`;
            }
            
            fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                // Hide loader
                document.getElementById('modalLoader').style.display = 'none';
                
                // Populate content
                renderWebhookTable(data.webhooks);
            })
            .catch(error => {
                document.getElementById('modalLoader').style.display = 'none';
                document.getElementById('modalContent').innerHTML = `<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error}</p>`;
            });
        
        // Show modal
        document.getElementById('webhookModal').style.display = 'block';
    }
    
    // Render webhook table in modal
    function renderWebhookTable(webhooks) {
        if (!webhooks || webhooks.length === 0) {
            document.getElementById('modalContent').innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>';
            return;
        }
        
        let tableHTML = `
            <table class="filtered-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è (–ú–°–ö)</th>
                        <th>–î–∞–Ω–Ω—ã–µ</th>
                    </tr>
                </thead>
                <tbody>
        `;
        
        webhooks.forEach(webhook => {
            tableHTML += `
                <tr>
                    <td>${webhook.id}</td>
                    <td>${webhook.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</td>
                    <td>${webhook.summa || 0}</td>
                    <td>${webhook.received_at}</td>
                    <td><button onclick="showRawData('${encodeURIComponent(webhook.raw_data)}')">–ü—Ä–æ—Å–º–æ—Ç—Ä</button></td>
                </tr>
            `;
        });
        
        tableHTML += `
                </tbody>
            </table>
        `;
        
        document.getElementById('modalContent').innerHTML = tableHTML;
    }
    
    // Show raw webhook data
    function showRawData(encodedData) {
        const rawData = decodeURIComponent(encodedData);
        alert(rawData);
    }
    
    // Add filter tag 
    function addFilterTag(type, value) {
        const filterContainer = document.getElementById('activeFilters');
        const displayValue = type === 'type' ? `–¢–∏–ø: ${value}` : `–î–∞—Ç–∞: ${value}`;
        
        const tagElement = document.createElement('div');
        tagElement.className = 'filter-tag';
        tagElement.innerHTML = `
            ${displayValue}
            <span class="remove" onclick="removeFilter('${type}')">&times;</span>
        `;
        
        filterContainer.appendChild(tagElement);
    }
    
    // Remove filter
    function removeFilter(type) {
        if (type === 'date') {
            // Reset to processing date
            currentViewDate = "{{ processing_date }}";
            
            // If we have a hook type selected, refresh the view
            if (currentHookType) {
                showWebhookDetails(currentHookType, document.querySelector(`.webhook-type[data-hook-id="${currentHookType}"] .webhook-type-title`).textContent.substr(3));
            }
        } else if (type === 'type') {
            // Close the modal
            closeModal();
        }
    }
    
    // Close modal
    function closeModal() {
        document.getElementById('webhookModal').style.display = 'none';
        currentHookType = null;
    }
    
    // Close modal when clicking outside the content
    window.onclick = function(event) {
        const modal = document.getElementById('webhookModal');
        if (event.target === modal) {
            closeModal();
        }
    };
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞
    function initTimeFilter() {
        // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–º
        const filterTypeRadios = document.querySelectorAll('input[name="timeFilterType"]');
        const specificTimeInput = document.getElementById('specificTimeValue');
        const timeFromInput = document.getElementById('timeFrom');
        const timeToInput = document.getElementById('timeTo');
        const applyButton = document.getElementById('applyTimeFilter');
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∏–ø–∞ —Ñ–∏–ª—å—Ç—Ä–∞
        filterTypeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                // –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ –ø–æ–ª—è –≤–≤–æ–¥–∞ –≤—Ä–µ–º–µ–Ω–∏
                specificTimeInput.disabled = true;
                timeFromInput.disabled = true;
                timeToInput.disabled = true;
                
                // –í–∫–ª—é—á–∞–µ–º –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±–æ—Ä–∞
                if (this.value === 'specificTime') {
                    specificTimeInput.disabled = false;
                } else if (this.value === 'timeRange') {
                    timeFromInput.disabled = false;
                    timeToInput.disabled = false;
                }
            });
        });
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –ø–æ–ª—è –≤–≤–æ–¥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const now = new Date();
        const currentHour = now.getHours().toString().padStart(2, '0');
        const currentMinute = now.getMinutes().toString().padStart(2, '0');
        const currentTime = `${currentHour}:${currentMinute}`;
        
        specificTimeInput.value = currentTime;
        timeFromInput.value = '00:00';
        timeToInput.value = currentTime;
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞
        applyButton.addEventListener('click', applyTimeFilter);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤—Ä–µ–º–µ–Ω–∏ –≤ URL –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
        if (timePoint) {
            document.getElementById('specificTime').checked = true;
            document.getElementById('specificTimeValue').disabled = false;
            document.getElementById('specificTimeValue').value = timePoint;
            document.getElementById('currentTimeFilter').textContent = `–ü–æ–∫–∞–∑–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –Ω–∞ ${timePoint}`;
        } else if (timeFrom && timeTo) {
            document.getElementById('timeRange').checked = true;
            document.getElementById('timeFrom').disabled = false;
            document.getElementById('timeTo').disabled = false;
            document.getElementById('timeFrom').value = timeFrom;
            document.getElementById('timeTo').value = timeTo;
            document.getElementById('currentTimeFilter').textContent = `–ü–æ–∫–∞–∑–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ —Å ${timeFrom} –¥–æ ${timeTo}`;
        }
    }
    
    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞
    function applyTimeFilter() {
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∏–ø —Ñ–∏–ª—å—Ç—Ä–∞
        const selectedFilter = document.querySelector('input[name="timeFilterType"]:checked').value;
        
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏–∑ URL –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –æ–±—Ä–∞–±–æ—Ç–∫–∏
        let dateParam = selectedDateParam;
        if (!dateParam) {
            dateParam = document.getElementById('processingDate').textContent;
        }
        
        // –§–æ—Ä–º–∏—Ä—É–µ–º URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞
        let url = `/?date=${dateParam}`;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ñ–∏–ª—å—Ç—Ä–∞
        if (selectedFilter === 'specificTime') {
            const specificTime = document.getElementById('specificTimeValue').value;
            if (specificTime) {
                url += `&timePoint=${specificTime}`;
            }
        } else if (selectedFilter === 'timeRange') {
            const timeFrom = document.getElementById('timeFrom').value;
            const timeTo = document.getElementById('timeTo').value;
            if (timeFrom && timeTo) {
                url += `&timeFrom=${timeFrom}&timeTo=${timeTo}`;
            }
        }
        
        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
        window.location.href = url;
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        initTimeFilter();
    });
    
    // Auto-refresh every minute
    setInterval(function() {
        location.reload();
    }, 60000);
</script>
</body>
</html>